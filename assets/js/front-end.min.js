jQuery(document).ready(function($){var Ask_Me_Anything={init:function(){$(".ask-me-anything-trigger-button").click(function(e){e.preventDefault();var targetID=$(this).data("target");if(targetID==""||typeof targetID==="undefined"){return false}Ask_Me_Anything.launchModal(targetID)})},launchModal:function(targetID){$("body").append('<div id="ask-me-anything-backdrop"></div>');$("#ask-me-anything-backdrop").addClass("ama-in");$(targetID).show().addClass("ama-in");Ask_Me_Anything.loadFormTemplate();if(ASK_ME_ANYTHING.display_questions==true){Ask_Me_Anything.loadQuestions(1)}},closeModal:function(){$("#ask-me-anything").hide();$("#ask-me-anything-backdrop").remove()},loadFormTemplate:function(message){var amaFormTemplate=wp.template("ama-submit-form");var amaSubmitData={message:typeof message!=="undefined"?message:"",form_title_text:ASK_ME_ANYTHING.form_title_text,form_description:ASK_ME_ANYTHING.form_description,form_require_name:ASK_ME_ANYTHING.form_require_name,form_require_email:ASK_ME_ANYTHING.form_require_email,form_question_field_name:ASK_ME_ANYTHING.form_question_field_name};$(".ask-me-anything-submit-question").empty().append(amaFormTemplate(amaSubmitData));$(".ask-me-anything-submit-question-form").submit(function(e){e.preventDefault();var submitForm=$(this);document.body.style.cursor="wait";submitForm.find("button").attr("disabled",true);submitForm.append('<i class="fa fa-spinner fa-spin"></i>');var formData=$(this).serializeArray();var data={action:"ask_me_anything_submit_question",formData:formData,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){document.body.style.cursor="default";var responseClass="ama-error";if(response.success==true){responseClass="ama-success"}var finalMessage='<div class="'+responseClass+'">'+response.data+"</div>";if(response.success==true){Ask_Me_Anything.loadFormTemplate(finalMessage);if(ASK_ME_ANYTHING.display_questions==true){Ask_Me_Anything.loadQuestions(1)}}else{submitForm.find("button").attr("disabled",false);submitForm.find(".fa-spin, .ama-error").remove();submitForm.prepend(finalMessage)}})})},loadQuestions:function(page){var amaQuestionTemplate=wp.template("ama-question");var questionsList=$(".ask-me-anything-questions-list");questionsList.empty().append('<div style="text-align: center; padding: 1em;"><i class="fa fa-spinner fa-spin fa-3x"></i></div>');var data={action:"ask_me_anything_get_questions",page_number:page,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){questionsList.empty();if(response.success==true){var templateData={questions:response.data.questions,nextpage:response.data.next_page,previouspage:response.data.previous_page};questionsList.append(amaQuestionTemplate(templateData));Ask_Me_Anything.renderQuestion()}else{questionsList.append(response.data)}Ask_Me_Anything.pagination()})},pagination:function(){$(".ama-pagination button").click(function(e){e.preventDefault();var pageToLoad=$(this).data("page");Ask_Me_Anything.loadQuestions(pageToLoad)})},renderQuestion:function(){$(".ama-question-item").click(function(e){e.preventDefault();var questionID=$(this).data("postid");$(".ama-question-item").each(function(){$(this).removeClass("ama-active");if($(this).data("postid")==questionID){$(this).addClass("ama-active")}});var questionArea=$(".ask-me-anything-submit-question");questionArea.empty().append('<div style="text-align: center;"><i class="fa fa-spinner fa-spin fa-3x"></i></div>');var data={action:"ask_me_anything_load_question",question_id:questionID,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){if(response.success==true){var amaQuestionTemplate=wp.template("ama-single-question");questionArea.empty().append(amaQuestionTemplate(response.data));Ask_Me_Anything.initializeVoting(questionID);Ask_Me_Anything.loadCommentsTemplate(questionID);Ask_Me_Anything.submitComment();$(".ama-load-question-form").click(function(e){e.preventDefault();$(".ama-question-item").each(function(){$(this).removeClass("ama-active")});Ask_Me_Anything.loadFormTemplate()})}else{console.log(response)}})})},initializeVoting:function(questionID){$(".ama-up-vote, .ama-down-vote").click(function(e){if($(this).hasClass("ama-disabled")){return false}var votingParent=$(this).parent();votingParent.prepend('<i class="fa fa-spinner fa-spin" style="margin-right: 7px"></i>');var voteElement=$(this).find(".ama-vote-number");var voteType="up";if($(this).hasClass("ama-down-vote")){voteType="down"}$(this).addClass("ama-disabled");var data={action:"ask_me_anything_vote",vote_type:voteType,question_id:questionID,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){votingParent.find(".fa-spinner").remove();if(response.success==true){voteElement.text(response.data);var voteElementLeft=$(".ask-me-anything-questions-list #ama-question-item-"+questionID).find(".ama-"+voteType+"-vote").find(".ama-vote-number");console.log(voteElementLeft);if(typeof voteElementLeft!="undefined"){voteElementLeft.text(response.data)}}else{console.log(response)}})})},loadCommentsTemplate:function(questionID){var commentArea=$(".ama-comments-list");var data={action:"ask_me_anything_load_comments",question_id:questionID,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){if(response.success==true){var amaCommentsTemplate=wp.template("ama-comments");commentArea.empty().append(amaCommentsTemplate({comments:response.data}))}else{console.log(response)}})},submitComment:function(){$("#ama-submit-comment-form").submit(function(e){e.preventDefault();var submitForm=$(this);document.body.style.cursor="wait";submitForm.find("button").attr("disabled",true);submitForm.append('<i class="fa fa-spinner fa-spin"></i>');var questionID=$(this).closest(".ask-me-anything-submit-question").find(".ama-single-question-wrap").data("question-id");var formData=$(this).serializeArray();var data={action:"ask_me_anything_submit_comment",formData:formData,question_id:questionID,nonce:ASK_ME_ANYTHING.nonce};$.post(ASK_ME_ANYTHING.ajaxurl,data,function(response){submitForm.find("button").attr("disabled",false);submitForm.find(".fa-spin, .ama-error, .ama-success").remove();document.body.style.cursor="default";var responseClass="ama-error";if(response.success==true){responseClass="ama-success"}var responseMessage;if(response.success==true){responseMessage=response.data.message}else{responseMessage=response.data}var finalMessage='<div class="'+responseClass+'">'+responseMessage+"</div>";submitForm.prepend(finalMessage);if(response.success==true){var amaCommentsTemplate=wp.template("ama-comments");$(".ama-comments-list").append(amaCommentsTemplate({comments:response.data.comment_data}))}})})}};Ask_Me_Anything.init();$(document).mouseup(function(e){var container=$(".ask-me-anything-modal-inner");if(!container.is(e.target)&&container.has(e.target).length===0){Ask_Me_Anything.closeModal()}});document.addEventListener("keydown",function(ev){var keyCode=ev.keyCode||ev.which;if(keyCode===27){Ask_Me_Anything.closeModal()}});$(".ama-close-modal").click(function(e){e.preventDefault();Ask_Me_Anything.closeModal()})});